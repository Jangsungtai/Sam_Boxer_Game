# 포즈 데이터 분석 및 교정 파이프라인 계획서

## 3단계 요약

1. **1단계: 고급자세 기준정의** : K-Means Clustering : 상급자 데이터로 각 포즈 타입별 기준 포즈 정의 (Centroid)

2. **2단계: 평가항목 정의** : Random Forest Classifier : 포즈 타입별 변수 중요도 추출 (가중치 w_i)

3. **3단계: 포즈품질 습관 평가** : 가중 유클리드 거리 + 통계 분석 : 사용자 포즈 습관 및 개선점 분석

---

## 개요

본 문서는 복싱 게임에서 수집된 포즈 데이터를 분석하여 고급자세를 정의하고, 평가항목을 설정하며, 포즈 품질과 습관을 평가하는 3단계 데이터마이닝 기법 계획을 설명합니다.

**처리 방식**: 게임 종료 후 일괄 진단 방식
- 1-2단계: 게임 실행 전 모델 훈련 단계
- 3단계: 게임 종료 후 수집된 전체 데이터 일괄 분석

---

## 1단계: 고급자세 기준 정의

### 목표
상급자 데이터를 분석하여 각 복싱 동작의 '정답'이 무엇인지를 수학적으로 정의합니다.

### 추천 기법
**K-Means Clustering (K=1~3) with IQR Filter**

### 선택 이유
- 상급자 데이터에서 각 포즈 타입별 대표 포즈를 자동으로 추출
- 구현이 간단하고 해석이 쉬움
- 클러스터 중심을 기준 포즈로 사용 가능
- 계산 비용이 낮고 빠름
- 소규모 데이터셋에서도 효과적 (약 320개 샘플)

### 처리 시점
**게임 실행 전 - 모델 훈련 단계**

### 입력 데이터
- 상급자 포즈 데이터 (1세트, 약 320개 포즈)
  - 파일: `data/pose_data/상급자 Sample1.csv`

### 처리 과정
1. **이상치 제거**: IQR (Interquartile Range) 기반으로 상급자 데이터 내의 이상치 제거
2. **포즈 타입별 분리**: 각 포즈 타입(GUARD, JAB_L, STRAIGHT_R, WEAVE_L, WEAVE_R)별로 데이터 분리
3. **K-Means 클러스터링**: 각 포즈 타입별로 K-Means 수행
   - K=1: 단일 기준 포즈 정의
   - K=2~3: 여러 올바른 스타일 포괄 (테스트 권장)
4. **클러스터 중심 추출**: 각 클러스터의 중심을 해당 포즈의 기준 포즈로 정의

### 출력
- **포즈 타입별 기준 포즈 벡터 (Centroid)**: 8개 변수의 기준값
  - `left_fist_dist`, `left_fist_angle`
  - `right_fist_dist`, `right_fist_angle`
  - `left_arm_angle`, `right_arm_angle`
  - `nose_position`, `nose_above_shoulder`

### 역할
상급자 데이터를 분석하여 각 복싱 동작의 **'정답'이 무엇인지**를 Centroid 형태로 수학적으로 정의합니다.

---


## 2단계: 평가항목 정의

### 목표
상급자와 초심자 데이터를 학습하여, 특정 포즈(예: 잽)를 평가할 때 어떤 변수(예: 팔 각도)가 가장 중요한지에 대한 평가항목 가중치를 정의합니다.

### 추천 기법
**Random Forest Classifier (변수 중요도 추출 중심)**

### 선택 이유
- 숙련도 분류 수행 가능 (상급자/초심자)
- 변수 중요도를 자동으로 제공 → 3단계 가중치로 활용
- 과적합에 강하고 안정적
- 비선형 관계 학습 가능
- scikit-learn으로 구현이 간단
- 소규모 데이터셋에서도 효과적 (약 640개 샘플)

### 처리 시점
**게임 실행 전 - 모델 훈련 단계**

### 입력 데이터
- 상급자 포즈 데이터 (1세트, 약 320개 포즈)
  - 파일: `data/pose_data/상급자 Sample1.csv`
  - 레이블: "상급자" 또는 "고급"
- 초심자 포즈 데이터 (1세트, 약 320개 포즈)
  - 파일: `data/pose_data/초심자 Sample1.csv`
  - 레이블: "초심자" 또는 "초급"

### 처리 과정
1. **데이터 레이블링**: 각 데이터에 숙련도 클래스 레이블 부여
   - 상급자 데이터: "상급자" 또는 1
   - 초심자 데이터: "초심자" 또는 0
2. **포즈 타입별 모델 학습**: 각 포즈 타입별로 독립적으로 Random Forest 모델 학습
   - 2-class 분류 (상급자 vs 초심자)
   - 소규모 데이터셋이므로 교차 검증(Cross-Validation) 권장
3. **숙련도 분류**: 포즈 데이터로 숙련도 분류 수행
4. **변수 중요도 추출**: 각 포즈 타입별로 어떤 변수가 숙련도 구분에 중요한지 파악
   - Feature Importance 점수 추출
   - 포즈 타입별로 중요 변수 순위화

### 출력
- **포즈 타입별 변수 가중치 (w_i)**: 8개 변수 각각의 중요도 점수
  - 각 포즈 타입별로 변수 중요도가 다를 수 있음
  - 예: JAB_L에서는 `left_arm_angle`이 중요, WEAVE_L에서는 `nose_position`이 중요

### 역할
특정 포즈(예: 잽)를 평가할 때 **어떤 변수(예: 팔 각도)가 가장 중요한지**에 대한 평가항목 가중치를 정의합니다.

---

## 3단계: 포즈품질 습관 평가

### 목표
게임이 끝난 후, 수집된 모든 노트 데이터에 대해 1단계의 기준 포즈(Centroid)와 2단계의 평가항목 가중치(w_i)를 사용하여 노트별 품질 점수를 계산하고, 그 결과를 모아 사용자의 포즈 품질과 습관을 분석한 종합 보고서를 생성합니다.

### 추천 기법
**가중 유클리드 거리 (Weighted Euclidean Distance) + 통계 분석**

### 선택 이유
- 1단계에서 정의한 기준 포즈와의 거리로 평가 가능
- 2단계에서 추출한 변수 중요도를 가중치로 활용
- 포즈 타입별로 중요 변수에 더 높은 가중치 부여
- 일괄 처리로 전체 데이터 분석 가능
- 습관 및 패턴 분석 가능
- 실시간 처리 부담 없이 심층적인 자기 분석 자료 제공

### 처리 시점
**게임 종료 후 - 일괄 처리**

### 입력 데이터
- 사용자가 수행한 전체 포즈 데이터 (게임 중 수집된 모든 노트)
- 1단계 기준 포즈 벡터 (Centroid)
- 2단계 변수 가중치 (w_i)

### 처리 과정

#### 1. 노트별 품질 점수 계산
- 모든 노트에 대해 가중 유클리드 거리 계산:
  ```
  Distance = √(Σ w_i × (x_user,i - x_기준,i)²)
  ```
- 거리를 점수로 변환:
  ```
  score = 100 - (distance × scale)
  ```

#### 2. 포즈 타입별 통계 분석
- 각 포즈 타입별 평균 품질 점수 계산
- 각 포즈 타입별 점수 분산 계산 (일관성 측정)
- 각 포즈 타입별 최고/최저 점수 기록
- 각 포즈 타입별 수행 횟수 기록

#### 3. 최대 오차 분석
- 각 포즈 타입별로 오차 거리가 가장 큰 상위 5개 노트 식별
- 이 노트들에서 가장 크게 이탈한 변수 분석
- 공통 오차 패턴 파악

#### 4. 습관 진단
- 각 포즈 타입별로 가장 빈번하게 발생한 오차 유형 파악
- 변수별 평균 오차 분석
  - 예: `left_arm_angle`이 평균적으로 기준보다 낮음
  - 예: `nose_position`의 분산이 높아 일관성 부족
- 포즈 타입별 일관성 평가 (분산 분석)

### 출력
**종합 교정 보고서** (포즈 타입별 진단 결과 및 구체적 교정 방향)

### 보고서 내용 예시

```
=== 포즈 종합 진단 보고서 ===

1. JAB (왼손 잽) 진단:
   - 평균 점수: 75점
   - 일관성: 낮음 (분산 높음)
   - 수행 횟수: 20회
   - 주요 문제: left_arm_angle이 기준(160°)보다 평균 125°로 낮음
   - 교정 방향: "팔을 더 펴는 연습이 필요합니다."

2. STRAIGHT (오른손 스트레이트) 진단:
   - 평균 점수: 82점
   - 일관성: 보통
   - 수행 횟수: 18회
   - 주요 문제: right_fist_dist가 기준보다 작음
   - 교정 방향: "팔을 더 앞으로 뻗으세요."

3. WEAVE (위빙) 진단:
   - WEAVE_L 평균 점수: 68점
   - WEAVE_R 평균 점수: 72점
   - 일관성: 매우 낮음
   - 수행 횟수: WEAVE_L 15회, WEAVE_R 17회
   - 주요 문제: nose_position의 분산이 높아 좌우 위빙 시 자세 일관성 부족
   - 교정 방향: "WEAVE_L 시 너무 짧게 움직입니다. 더 크게 기울이세요."

4. GUARD (가드) 진단:
   - 평균 점수: 88점
   - 일관성: 높음
   - 수행 횟수: 30회
   - 평가: 가장 안정적인 포즈입니다.
```

---

## 전체 파이프라인 요약

```
[게임 실행 전 - 모델 훈련]
1단계: 고급자세 기준정의 (K-Means, K=1~3, 이상치 제거) 
  → 상급자 데이터로 각 포즈 타입별 기준 포즈 정의 (Centroid)
         ↓
2단계: 평가항목 정의 (Random Forest)
  → 상급자/초심자 분류 + 포즈 타입별 변수 중요도 추출 (가중치 w_i)
         ↓
[게임 종료 후 - 일괄 진단]
3단계: 포즈품질 습관 평가 (가중 유클리드 거리 + 통계 분석)
  → 전체 노트 데이터 분석
  → 노트별 점수 계산
  → 포즈 타입별 통계 분석
  → 습관 진단 및 종합 교정 보고서 생성
```

## 데이터 수집 규모

- **1세트**: 약 320개의 포즈 데이터 (5가지 포즈 타입 포함)
- **상급자**: 1세트 (약 320개 포즈)
  - 파일: `data/pose_data/상급자 Sample1.csv`
- **초심자**: 1세트 (약 320개 포즈)
  - 파일: `data/pose_data/초심자 Sample1.csv`
- **총계**: 2세트, 약 640개 포즈 데이터

### 데이터 구성
각 CSV 파일은 다음 5가지 포즈 타입을 포함합니다:
- GUARD (가드)
- JAB_L (왼손 잽)
- STRAIGHT_R (오른손 스트레이트)
- WEAVE_L (위빙 좌)
- WEAVE_R (위빙 우)

### 주의사항
- 현재 데이터는 소규모 데이터셋이므로, 모델 학습 시 교차 검증(Cross-Validation)을 활용하여 안정성을 확보해야 합니다.
- 향후 데이터가 추가되면 모델 성능이 향상될 수 있습니다.

## 포즈 타입

1. **GUARD** (가드): 양손 얼굴에 최대한 밀착하여 방어
2. **JAB_L** (왼손 잽): 왼팔 직선으로 뻗고, 오른팔은 가드
3. **STRAIGHT_R** (오른손 스트레이트): 오른팔 직선으로 뻗고, 왼팔은 가드
4. **WEAVE_L** (위빙 좌): 가드 자세 유지, 오른쪽으로 기울임
5. **WEAVE_R** (위빙 우): 가드 자세 유지, 왼쪽으로 기울임

## 포즈 데이터 변수 (8개)

| 변수명 | 설명 | 좌표계 |
|--------|------|--------|
| `left_fist_dist` | 왼손 거리 (정규화) | 상대 극좌표계 (코 기준) |
| `left_fist_angle` | 왼손 각도 | 상대 극좌표계 (코 기준) |
| `right_fist_dist` | 오른손 거리 (정규화) | 상대 극좌표계 (코 기준) |
| `right_fist_angle` | 오른손 각도 | 상대 극좌표계 (코 기준) |
| `left_arm_angle` | 왼팔 각도 (어깨-팔꿈치-손목) | 벡터 각도 |
| `right_arm_angle` | 오른팔 각도 (어깨-팔꿈치-손목) | 벡터 각도 |
| `nose_position` | 코 위치 (화면 중앙 기준, 정규화) | 카테시안 좌표계 (X축) |
| `nose_above_shoulder` | 코가 어깨 위에 있는지 여부 | 카테시안 좌표계 (Y축) |

## 추천 도구 및 라이브러리

- **데이터 분석**: pandas, numpy
- **머신러닝**: scikit-learn (K-Means, Random Forest)
- **시각화**: matplotlib, seaborn
- **통계 분석**: scipy

## 구현 우선순위

1. **Phase 1**: 1단계 구현 (고급자세 기준 정의)
2. **Phase 2**: 2단계 구현 (평가항목 정의)
3. **Phase 3**: 3단계 구현 (포즈품질 습관 평가)
4. **Phase 4**: 게임 시스템 통합 (보고서 표시 기능)

---

## 참고사항

- 본 계획은 게임 종료 후 일괄 진단 방식으로 설계되었습니다.
- 실시간 피드백의 부담 없이 플레이어에게 심층적인 자기 분석 자료를 제공합니다.
- 각 단계는 독립적으로 구현 가능하며, 단계별 검증 후 다음 단계로 진행하는 것을 권장합니다.
- 현재 데이터는 소규모 데이터셋(약 640개 샘플)이므로, 모델 학습 시 교차 검증을 활용하여 안정성을 확보해야 합니다.
- 향후 더 많은 데이터가 수집되면 모델 성능과 정확도가 향상될 수 있습니다.

